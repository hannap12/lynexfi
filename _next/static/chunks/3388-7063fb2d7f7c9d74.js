!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c05c6a3d-62c6-47b0-9b1e-80ae0e929fcd",e._sentryDebugIdIdentifier="sentry-dbid-c05c6a3d-62c6-47b0-9b1e-80ae0e929fcd")}catch(e){}}();var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};"use strict";e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[Error().stack]=Object.assign({},e._sentryModuleMetadata[Error().stack],{"_sentryBundlerPluginAppKey:awesomeqa-sentry-frontend-application-key":!0}),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3388],{87615:function(e,t,n){n.r(t),n.d(t,{copyToClipboard:function(){return copyToClipboard}});var copyToClipboard=function(e){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(t){console.warn("Copy to clipboard failed.",t),prompt("Copy to clipboard: Ctrl+C, Enter",e)}finally{document.body.removeChild(t)}}}},85684:function(e,t,n){n.r(t),n.d(t,{capitalizeFirstLetter:function(){return capitalizeFirstLetter}});var capitalizeFirstLetter=function(e){return e.toLowerCase().replace(/\w/,function(e){return e.toUpperCase()})}},63388:function(e,t,n){var a,o,r,s=n(83454),i=n(64836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n,a,o,s,i,b,z,H,Q,Y,J,Z,$,V,X,ee,et=e.pageProps,en=e.autostart,ea=void 0!==en&&en,eo="error"in et,er=null!==(s=et.communityId)&&void 0!==s?s:"",es=et.configData,ei=et.encodedConversationTicketSourceUrl,ec=null!==(i=et.ticketConversationId)&&void 0!==i?i:"",eu=ea?"":null!==(b=sessionStorage.getItem(K))&&void 0!==b?b:"",ed=(0,x.useAppDispatch)(),el=null!==(z=null==es?void 0:es.theme)&&void 0!==z?z:"light";(0,E.useEffect)(function(){ed((0,O.setTheme)({theme:el}))},[el,ed]);var ep=(0,A.useCreateConversationMutation)(),ef=(0,M.default)(ep,1)[0],eg=(0,A.useAddActionMessageToConversationMutation)(),em=(0,M.default)(eg,1)[0],ev=(0,A.useAddLogForConversationMutation)(),ey=(0,M.default)(ev,1)[0],eh=(0,A.useAddConversationTicketMutation)(),eC=(0,M.default)(eh,2),ew=eC[0],eS=eC[1],e_=(0,A.useSaveConversationMessageMutation)(),eT=(0,M.default)(e_,1)[0],eb=(0,E.useState)(""),eM=eb[0],ek=eb[1],eE=(0,E.useState)(!1),eA=eE[0],ex=eE[1],eO=(0,E.useState)(!1),eI=eO[0],eN=eO[1],eP=(0,E.useState)(!1),eD=eP[0],eR=eP[1],ej=(0,E.useState)(!1),eq=ej[0],eU=ej[1],eL=(0,E.useState)(!1),eG=eL[0],eW=eL[1],eB=(0,E.useState)(!1),eF=eB[0],ez=eB[1],eK=(0,E.useState)(!1),eH=eK[0],eQ=eK[1],eY=(0,E.useState)(ea),eJ=eY[0],eZ=eY[1],e$=(0,E.useState)(!1),eV=e$[0],eX=e$[1],e0=(0,E.useState)([]),e1=e0[0],e6=e0[1],e2=(0,E.useState)(),e3=e2[0],e4=e2[1],e8=(0,E.useState)(""),e5=e8[0],e9=e8[1],e7=!!(null!=eS&&eS.data),te=ec||eu,tt=(0,A.useGetConversationTicketQuery)({conversationId:te},{refetchOnMountOrArgChange:!0,skip:e7||!te}).data,tn=(0,A.useGetConversationQuery)({conversationId:te},{refetchOnMountOrArgChange:!0,skip:e7||!te}).data,ta=(0,E.useState)(),to=ta[0],tr=ta[1],ts=(0,E.useState)([]),ti=ts[0],tc=ts[1];(0,E.useEffect)(function(){var e,t;tc(null!==(e=null==es?void 0:null===(t=es["qa-suggestions"])||void 0===t?void 0:t.suggestions)&&void 0!==e?e:[])},[es]);var tu=(0,E.useState)(!1),td=tu[0],tl=tu[1];(0,E.useEffect)(function(){tl(!e3&&ti.length>0)},[ti,e3]);var tp=(0,E.useState)(new Map),tf=tp[0],tg=tp[1],tm=(0,A.useGetConversationSupportAgentsQuery)({communityId:er},{refetchOnMountOrArgChange:!0,skip:!(null!=es&&es["human-live-chat-support"])||!er||!e3,pollingInterval:1e4}).data;(0,E.useEffect)(function(){tm&&tg(new Map(tm.slice().sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(e){return[String(e.id),e]})))},[tm]);var tv=(0,E.useState)(null),ty=tv[0],th=tv[1],tC=(0,E.useState)(null),tw=tC[0],tS=tC[1],t_=(0,E.useState)(null),tT=t_[0],tb=t_[1],tM=(0,E.useState)(!1),tk=tM[0],tE=tM[1],tA=(0,E.useRef)(null),tx=null!==(H=null==es?void 0:es["is-mobile"])&&void 0!==H&&H,tO=parseInt((null!==(Q=null==es?void 0:es["widget-button-px-size"])&&void 0!==Q?Q:"64").toString()),tI=(0,L.useWebSupportStyles)(),tN=(0,L.useEmptyStyles)(),tP=ea?tN:tI,tD=null!==(Y=null==es?void 0:es["primary-color"])&&void 0!==Y?Y:"dark"==el?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.3)",tR=(0,U.createTheme)((0,I.merge)({},"dark"==el?q.darkThemeParams:q.lightThemeParams,{palette:{primary:{main:tD}}}));(0,E.useEffect)(function(){eo||(te?eu?ek(eu):ek(ec):function(){return _createConversation.apply(this,arguments)}());function _createConversation(){return(_createConversation=(0,k.default)(c.default.mark(function _callee2(){var e,t,n,a;return c.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return ex(!0),o.next=3,ef({body:{community_id:er,first_message:null!==(e=null==es?void 0:es["first-message"])&&void 0!==e?e:""}});case 3:if(!("error"in(a=o.sent))){o.next=6;break}return o.abrupt("return",sendErrorMessage());case 6:ek(null!==(t=a.data.conversation.id)&&void 0!==t?t:""),e6(null!==(n=a.data.conversation.messages)&&void 0!==n?n:[]),ex(!1);case 9:case"end":return o.stop()}},_callee2)}))).apply(this,arguments)}},[]),(0,E.useEffect)(function(){eJ&&eX(!1)},[eJ]);var setChatCardOpenState=function(e){window.parent.postMessage(e?"awesomeqa-widget-opened":"awesomeqa-widget-closed","*");var t=e?"open_widget":"close_widget";eZ(e),ey({conversationId:eM,body:{activity:t,community_id:er}}),tk&&!e&&makeWidgetDisappear(),e&&!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&setTimeout(function(){var e;null==tA||null===(e=tA.current)||void 0===e||e.focus()},100)},toggleChatCard=function(){setChatCardOpenState(!eJ)};(0,E.useEffect)(function(){eJ||eX(!0)},[eA,e1]);var createMessage=function(e){var t=e.messageType,n=e.source,a=e.sourceId,o=e.content,r=e.newStatus,s=e.assignedAgentId;if(t!==W.ConversationMessageType.ASSISTANT&&t!==W.ConversationMessageType.AGENT&&t!==W.ConversationMessageType.USER&&t!==W.ConversationMessageType.STATUS_CHANGE)throw Error("Message type ".concat(t," is not allowed"));if(t===W.ConversationMessageType.ASSISTANT&&!o){console.log("Message type assisstant requires content");return}if((t===W.ConversationMessageType.AGENT||t===W.ConversationMessageType.USER)&&!(n&&o)){console.log("Message type agent or user requires source and content");return}return{id:Math.random().toString(),message_type:t,content:o,conversation_id:eM,timestamp:new Date().toISOString(),new_status:r,assigned_agent_id:s,source:n,source_id:a}};(0,E.useEffect)(function(){tt&&(setChatCardOpenState(!0),e9(tt.enduser_email),e4(tt))},[tt]),(0,E.useEffect)(function(){if(tn){var e;e6(null!==(e=tn.messages)&&void 0!==e?e:[])}},[tn]),(0,E.useEffect)(function(){var e;e3&&((null==e1?void 0:null===(e=e1[e1.length-1])||void 0===e?void 0:e.message_type)===W.ConversationMessageType.AGENT?eU(!0):eU(!1))},[e3,e1]);var createSocketConnection=function(){if(eM&&e5){ty&&(ty.off("connect"),ty.off("message"),ty.off("disconnect"),ty.disconnect());var e="".concat(window.location.origin,"/enduser");console.log("Creating websocket connection to ".concat(e)),th((0,B.io)(e,{path:"/api/socket.io",query:{email:encodeURIComponent(e5),conversation_id:encodeURIComponent(eM)},autoConnect:!0,secure:!0,transports:["websocket","polling"]}))}};(0,E.useEffect)(function(){e5&&createSocketConnection()},[e5]),(0,E.useEffect)(function(){if(ty)return ty.on("connect",function(){console.log("Connected to the server as enduser id: ".concat(e5," and conversation id: ").concat(eM)),tw&&sendTransaction()}),ty.on("message",function(e,t){tb(e),t&&t(e)}),ty.on("disconnect",function(){console.log("Disconnected from the server as enduser id: ".concat(e5," and conversation id: ").concat(eM))}),function(){ty.disconnect(),ty.off("disconnect"),ty.off("connect"),ty.off("message")}},[ty]),(0,E.useEffect)(function(){if(tT){if(tT.type===W.TransactionType.MESSAGE){var e;to&&(clearTimeout(to),tr(void 0)),tT.source_id===(null==e3?void 0:e3.enduser_email)?e=createMessage({messageType:W.ConversationMessageType.USER,source:W.ConversationMessageSource.END_USER,sourceId:tT.source_id,content:tT.data.message}):"awesomeqa-assistant"===tT.source_id?(e=createMessage({messageType:W.ConversationMessageType.ASSISTANT,content:tT.data.message}),e9(""),null==ty||ty.disconnect(),th(null)):e=createMessage({messageType:W.ConversationMessageType.AGENT,source:W.ConversationMessageSource.AGENT,sourceId:tT.source_id,content:tT.data.message}),e&&(addMessageToChat(e),setActions([r.THANKS]))}else if(tT.type===W.TransactionType.STATUS_CHANGE){if(e4(function(e){return _objectSpread(_objectSpread({},e),{},{current_status:tT.data.new_status,updated_at:new Date().toISOString()})}),tT.data.new_status===W.ConversationTicketStatus.RESOLVED){var t=createMessage({messageType:W.ConversationMessageType.STATUS_CHANGE,source:W.ConversationMessageSource.AGENT,sourceId:tT.source_id,newStatus:tT.data.new_status});t&&addMessageToChat(t)}}else tT.type===W.TransactionType.AGENT_ASSIGNMENT?e4(function(e){return _objectSpread(_objectSpread({},e),{},{assigned_agent_id:tT.data.new_assigned_agent_id,updated_at:new Date().toISOString()})}):console.error("Transaction type ".concat(tT.type," is not supported."))}},[tT]);var sendTransaction=function(){if(tw)try{null==ty||ty.emit("message",tw),tS(null)}catch(e){console.error("Error sending message:",e)}};(0,E.useEffect)(function(){if(tw){if(!ty)return console.log("No websocket connection."),createSocketConnection();sendTransaction()}},[tw]);var addMessageToChat=function(e){e6(function(t){return[].concat((0,T.default)(t),[e])})},getResponseFromQuestionAnswerSuggestions=function(e){var t=(0,T.default)(ti);if(0!==t.length)for(var _loop=function(n){var a=t[n];if(a.question.toLowerCase()===e.trim().toLowerCase())return tc(function(e){return e.filter(function(e,t){return t!==n})}),{v:a.answer}},n=0;n<t.length;n++){var a=_loop(n);if("object"==typeof a)return a.v}},tj=(t=(0,k.default)(c.default.mark(function _callee3(e){var t,n;return c.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:tl(!1),e3?tS({type:W.TransactionType.MESSAGE,community_id:er,conversation_id:e3.conversation_id,source_id:e3.enduser_email,destination_id:String(e3.assigned_agent_id),data:{message:e}}):(ex(!0),eN(!0),t=new EventSource("/api/conversations/".concat(eM,"/messages?message_content=").concat(e)),n=!0,t.onmessage=function(e){n&&eN(!1),addMessageFromResponse({data:JSON.parse(e.data)},!n),n=!1,t.addEventListener("stream-ended",function(){t.close(),ex(!1)})});case 2:case"end":return a.stop()}},_callee3)})),function(e){return t.apply(this,arguments)}),tq=(n=(0,k.default)(c.default.mark(function _callee4(){var e,t,n,a,o;return c.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(!(n=(null!==(e=null==tA?void 0:null===(t=tA.current)||void 0===t?void 0:t.value)&&void 0!==e?e:"").trim())||!eM)){r.next=3;break}return r.abrupt("return");case 3:if(tA.current.value="",(a=createMessage({messageType:W.ConversationMessageType.USER,source:W.ConversationMessageSource.END_USER,content:n}))&&addMessageToChat(a),!(o=getResponseFromQuestionAnswerSuggestions(n))){r.next=14;break}ex(!0),eN(!0),eT({conversationMessage:{conversation_id:eM,content:n,message_type:W.ConversationMessageType.QA_SUGGESTION,source:W.ConversationMessageSource.END_USER}}),setTimeout(function(){var e=createMessage({messageType:W.ConversationMessageType.ASSISTANT,content:o});e&&addMessageToChat(e),eT({conversationMessage:{conversation_id:eM,content:o,message_type:W.ConversationMessageType.QA_SUGGESTION}}),ex(!1),eN(!1)},1e3),r.next=16;break;case 14:return r.next=16,tj(n);case 16:case"end":return r.stop()}},_callee4)})),function(){return n.apply(this,arguments)}),sendErrorMessage=function(){var e=createMessage({messageType:W.ConversationMessageType.ASSISTANT,content:"Sorry, something went wrong. Please try again later."});e&&addMessageToChat(e),eR(!0)},tU=(a=(0,k.default)(c.default.mark(function _callee5(e){var t,n;return c.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(es){a.next=2;break}return a.abrupt("return");case 2:if(ex(!0),eN(!0),t=es.actions[e].title,(n=createMessage({messageType:W.ConversationMessageType.USER,source:W.ConversationMessageSource.END_USER,content:t}))&&addMessageToChat(n),setActions([]),"contact-support"!=e||es["human-live-chat-support"]||eW(!0),e3){a.next=16;break}return a.next=12,em({conversationId:eM,body:{message_content:t,action:e,action_response:es.actions[e].response}});case 12:addMessageFromResponse(a.sent),a.next=17;break;case 16:tS({type:W.TransactionType.MESSAGE,community_id:er,conversation_id:e3.conversation_id,source_id:e3.enduser_email,destination_id:String(e3.assigned_agent_id),data:{message:t}});case 17:ex(!1),eN(!1);case 19:case"end":return a.stop()}},_callee5)})),function(e){return a.apply(this,arguments)}),setActions=function(e){eR(e.includes(r.CONTACT_SUPPORT)),eU(e.includes(r.THANKS))},addMessageFromResponse=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("error"in e)return sendErrorMessage();t?e6(function(t){var n=_objectSpread(_objectSpread({},t[t.length-1]),{},{content:e.data.response_message.content});return[].concat((0,T.default)(t.slice(0,-1)),[n])}):addMessageToChat(e.data.response_message),setActions(e.data.allowed_actions)},copyChat=function(){var e=e1.reduce(function(e,t){return e+"\n\n"+(0,P.capitalizeFirstLetter)(t.message_type)+": "+t.content},"Chat Export (".concat(new Date().toLocaleString(),")"));(0,N.copyToClipboard)(e),ez(!0),setTimeout(function(){ez(!1)},4e3)},sendThanksMessageOnEnterEmail=function(){var e=createMessage({messageType:W.ConversationMessageType.ASSISTANT,content:"37289270-4c79-4a1e-84b0-81f82d8f2dc9"==er?"An agent will respond within 24-48 hours. You can get faster support by upgrading your account to Pro.":"Thanks! One of our agents will be here quickly \uD83D\uDE0A"});e&&addMessageToChat(e)},getConversationTicketSourceUrl=function(){var e=new URL(decodeURIComponent(ei));return e.searchParams.set("ticketConversationId",eM),e.toString()},tL=(o=(0,k.default)(c.default.mark(function _callee6(e){return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:sendThanksMessageOnEnterEmail(),e9(e),ew({conversationTicket:{conversation_id:eM,community_id:er,enduser_email:e,source_url:getConversationTicketSourceUrl()}}).then(function(e){if("error"in e){console.error("Cannot create conversation ticket",e.error);return}if(storeConversationIdInSessionStorage(e.data.conversation_id),e4(e.data),tS({type:W.TransactionType.NEW_TICKET,community_id:er,conversation_id:e.data.conversation_id,source_id:e.data.enduser_email,data:{ticket:_objectSpread({},e.data)}}),null!=es&&es["human-live-chat-first-message"]){var t=createMessage({messageType:W.ConversationMessageType.ASSISTANT,content:es["human-live-chat-first-message"]});t&&addMessageToChat(t)}tr(setTimeout(sendNoAgentAvailableOnEnterEmail,6e4))}).catch(function(e){console.error("Error creating conversation ticket",e)});case 3:case"end":return t.stop()}},_callee6)})),function(e){return o.apply(this,arguments)}),sendNoAgentAvailableOnEnterEmail=function(){var e=createMessage({messageType:W.ConversationMessageType.ASSISTANT,content:"It seems like our agents are rushing today \uD83D\uDE23 you will be notified via email when one of them responds \uD83D\uDE4C"});e&&addMessageToChat(e)};(0,E.useEffect)(function(){eM&&ey({conversationId:eM,body:{activity:"initialize_widget",community_id:er}})},[eM,ey,er]);var handleClose=function(){eM&&ey({conversationId:eM,body:{activity:"close_window",community_id:er}})};(0,E.useEffect)(function(){document.documentElement.style.setProperty("color-scheme","normal"),document.documentElement.style.setProperty("overflow","hidden"),eQ(!0)},[el,eo]),(0,E.useEffect)(function(){return window.addEventListener("beforeunload",handleClose),function(){window.removeEventListener("beforeunload",handleClose)}},[]),(0,E.useEffect)(function(){eo&&(console.log("Not showing awesomeQA web support because of "+et.error),makeWidgetDisappear())},[eo,et.error]);var makeWidgetAppear=function(){window.parent.postMessage("awesomeqa-widget-appear","*")},makeWidgetDisappear=function(){window.parent.postMessage("awesomeqa-widget-disappear","*"),tE(!1)};(0,E.useEffect)(function(){!eo&&eH&&(null==es?void 0:es["hide-on-load"])!==!0&&(makeWidgetAppear(),setTimeout(function(){makeWidgetAppear()},500))},[eo,eH,es]),(0,E.useEffect)(function(){var handleMessage=function(e){"awesomeqa-invoke-appear-closed"===e.data&&(makeWidgetAppear(),setChatCardOpenState(!1)),"awesomeqa-invoke-appear-opened"===e.data&&(makeWidgetAppear(),setChatCardOpenState(!0)),"awesomeqa-invoke-open"===e.data&&setChatCardOpenState(!0),"awesomeqa-invoke-close"===e.data&&setChatCardOpenState(!1),"awesomeqa-invoke-disappear"===e.data&&makeWidgetDisappear(),"awesomeqa-invoke-appear-opened-with-disappear-on-close"===e.data&&(tE(!0),makeWidgetAppear(),setChatCardOpenState(!0))};return window.addEventListener("message",handleMessage),function(){window.removeEventListener("message",handleMessage)}});var tG=(0,E.useState)(!1),tW=tG[0],tB=tG[1];return((0,E.useEffect)(function(){function _startAutostart(){return(_startAutostart=(0,k.default)(c.default.mark(function _callee7(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=9;break;case 4:return tA.current&&(tA.current.value="support please"),e.next=7,tq();case 7:return e.next=9,new Promise(function(e){return setTimeout(e,4e3+2e3*Math.random())});case 9:return e.next=11,tU("contact-support");case 11:return e.next=13,new Promise(function(e){return setTimeout(e,1e3+2e3*Math.random())});case 13:return e.next=15,tL("stresstest".concat(Math.random(),"@stresstest.com"));case 15:case"end":return e.stop()}},_callee7)}))).apply(this,arguments)}ea&&!tW&&eM&&tA.current&&(tB(!0),function(){_startAutostart.apply(this,arguments)}())},[ea,tW,tA,eM]),(0,E.useEffect)(function(){function _sendALotOfMessages(){return(_sendALotOfMessages=(0,k.default)(c.default.mark(function _callee8(){var e;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e3){t.next=11;break}e=0;case 2:if(!(e<10)){t.next=11;break}return t.next=5,new Promise(function(e){return setTimeout(e,1e3+2e3*Math.random())});case 5:return tA.current&&(tA.current.value="My message has the number ".concat(e)),t.next=8,tq();case 8:e++,t.next=2;break;case 11:case"end":return t.stop()}},_callee8)}))).apply(this,arguments)}ea&&function(){_sendALotOfMessages.apply(this,arguments)}()},[e3,tA]),!eo&&es&&er)?F(U.ThemeProvider,{theme:tR,"data-sentry-element":"ThemeProvider","data-sentry-component":"ChatWidget","data-sentry-source-file":"chat-widget.tsx"},F(y.default,{className:tP.container,style:{bottom:tx&&eJ?"0px":"16px",right:tx&&eJ?"0px":"16px",width:tx?"100vw":"calc(100vw - 16px)",height:tx?"100vh":"calc(100vh - 16px)"},"data-sentry-element":"Box","data-sentry-source-file":"chat-widget.tsx"},F(d.default,{className:tP.chatCard,style:{borderRadius:tx?"0px":"8px",bottom:tx?0:"".concat((null!=tO?tO:16)+10,"px"),height:eJ?tx?"100%":"calc(100% - ".concat((null!=tO?tO:16)+10,"px)"):0,opacity:eJ?1:0,transform:eJ?"scale(1) translateY(0)":"scale(0.7) translateY(50px)",transition:eJ?"transform 150ms ease-out, opacity 150ms ease-out":"none"},"data-sentry-element":"Card","data-sentry-source-file":"chat-widget.tsx"},F(w.default,{avatar:F(G.AvatarOrStyledIcon,{src:null!==(J=null==es?void 0:es["widget-icon-url"])&&void 0!==J?J:""},F(L.AssistantIcon,{sx:{width:24,height:24}})),classes:{content:tP.chatCardTitle},style:{whiteSpace:tx?"nowrap":"normal"},className:tP.header,action:F(S.default,{"aria-label":"close",onClick:toggleChatCard},F(_.default,null)),title:null!==(Z=null==es?void 0:es["widget-title"])&&void 0!==Z?Z:"Support Chat",titleTypographyProps:{variant:"h6",classes:{root:tP.chatCardTitle}},"data-sentry-element":"CardHeader","data-sentry-source-file":"chat-widget.tsx"}),F(C.default,{variant:"middle","data-sentry-element":"Divider","data-sentry-source-file":"chat-widget.tsx"}),F(R.default,{conversationMessages:e1,configData:es,isChatInitalizing:!eM,isLoadingResponse:eI,onEnterEmail:tL,emailSent:null!==($=null==e3?void 0:e3.enduser_email)&&void 0!==$?$:"",supportAgents:tf,ticketCreated:!!e3,"data-sentry-element":"ChatContent","data-sentry-source-file":"chat-widget.tsx"}),td&&F(y.default,{display:"flex",flexDirection:"column",gap:1,alignItems:"flex-end",padding:2,paddingBottom:1},ti.map(function(e,t){return F(h.default,{key:"qa_suggestions_".concat(t),variant:"outlined",size:"medium",onClick:(0,k.default)(c.default.mark(function _callee9(){return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return tA.current&&(tA.current.value=e.question),t.next=3,tq();case 3:case"end":return t.stop()}},_callee9)})),className:tP.chatQASuggestionButton,disabled:eA},e.question)})),(eq||eD||eG)&&F(E.default.Fragment,null,F(C.default,{variant:"middle"}),F(v.default,{className:"".concat(tP.cardActions," ").concat(tP.actionButtonRow)},eq&&F(h.default,{variant:"outlined",size:"medium",onClick:function(){return tU("thanks")},className:"".concat(tP.chatResolveButton," ").concat(tP.chatActionButton),disabled:eA},null!==(V=null==es?void 0:es.actions.thanks.title)&&void 0!==V?V:"Thanks, that's helpful! \uD83D\uDC4D"),eD&&F(h.default,{variant:"outlined",size:"medium",onClick:function(){return tU("contact-support")},className:"".concat(tP.chatResolveButton," ").concat(tP.chatActionButton),disabled:eA},null!==(X=null==es?void 0:es.actions["contact-support"].title)&&void 0!==X?X:"Contact Support"),F(y.default,{flexGrow:1}),eG&&F(h.default,{variant:"outlined",size:"medium",onClick:function(){return copyChat()},className:tP.chatResolveButton},F(D.default,null),eq&&eD?"":F(E.default.Fragment,null,"\xa0",eF?"Copied!":"Copy chat")))),F(v.default,{className:tP.cardActions,"data-sentry-element":"CardActions","data-sentry-source-file":"chat-widget.tsx"},F(f.default,{inputRef:tA,autoComplete:"off",multiline:!0,InputProps:{endAdornment:F(g.default,{position:"end"},F(S.default,{onClick:tq,disabled:eA,size:"large"},F(m.default,null))),style:{minHeight:"56px"}},className:tP.textField,onKeyDown:function(e){13!==e.keyCode||e.shiftKey||eA||(e.preventDefault(),tq())},"data-sentry-element":"TextField","data-sentry-source-file":"chat-widget.tsx"})),F(l.default,{sx:{paddingBottom:"16px !important"},"data-sentry-element":"CardContent","data-sentry-source-file":"chat-widget.tsx"},F("a",{href:"https://awesomeqa.xyz/",target:"_blank",rel:"noreferrer",className:tP.logo},F(p.default,{color:"dark"==el?"text.tertiary":"rgba(0,0,0,0.5)","data-sentry-element":"Typography","data-sentry-source-file":"chat-widget.tsx"},"Powered by"),F(j.Logo,{small:!0,white:"dark"==el,forceIncludeText:!0,"data-sentry-element":"Logo","data-sentry-source-file":"chat-widget.tsx"})))),!(eJ&&tx)&&F(S.default,{className:"".concat(tP.chatButton," ").concat(eJ?tP.chatOpen:""),onClick:toggleChatCard},F(u.default,{color:"error",variant:"dot",invisible:!eV,overlap:"circular",sx:{"& .MuiBadge-badge":{width:tO/4,height:tO/4,borderRadius:"50%"}}},F(G.AvatarOrStyledIcon,{sx:{width:tO,height:tO},src:null!==(ee=null==es?void 0:es["widget-icon-url"])&&void 0!==ee?ee:""},F(L.ChatBubbleIcon,{sx:{width:tO/2,height:tO/2}})))))):F(E.default.Fragment,null)},t.getServerSideProps=void 0;var c=i(n(64687)),u=i(n(69476)),d=i(n(34297)),l=i(n(50961)),p=i(n(89589)),f=i(n(52861)),g=i(n(79623)),m=i(n(26307)),v=i(n(48547)),y=i(n(55693)),h=i(n(94718)),C=i(n(79540)),w=i(n(73537)),S=i(n(74113)),_=i(n(50594)),T=i(n(861)),b=i(n(38416)),M=i(n(27424)),k=i(n(17156)),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_getRequireWildcardCache(t);if(n&&n.has(e))return n.get(e);var a={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&({}).hasOwnProperty.call(e,r)){var s=o?Object.getOwnPropertyDescriptor(e,r):null;s&&(s.get||s.set)?Object.defineProperty(a,r,s):a[r]=e[r]}return a.default=e,n&&n.set(e,a),a}(n(67294)),A=n(49396),x=n(17228),O=n(63997),I=n(96486),N=n(87615),P=n(85684),D=i(n(46441)),R=i(n(61562)),j=n(9811),q=n(73884),U=n(80895),L=n(33388),G=n(93219),W=n(94829),B=n(57046);function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_getRequireWildcardCache=function(e){return e?n:t})(e)}var F=E.default.createElement;function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){(0,b.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var z=(a=(0,k.default)(c.default.mark(function _callee(e){var t,n,a,o,r,i,u,d,l,p,f,g,m,v,y,h,C,w,S,_;return c.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,n=s.env.BASE_API_URL_IN_NETWORK,o=(a=e.query).communityId,r=a.config,i=a.encodedConversationTicketSourceUrl,d=Array.isArray(u=a.ticketConversationId)?u[0]:u,l="".concat(n,"/api/conversation-support-config?community_id=").concat(o),p=fetch(l),f="".concat(n,"/api/conversations/is-rate-limit-exceeded?community_id=").concat(o),g=fetch(f),c.next=10,Promise.all([p,g]);case 10:return m=c.sent,y=(v=(0,M.default)(m,2))[0],h=v[1],c.next=16,h.json();case 16:if(!c.sent.is_rate_limit_exceeded){c.next=19;break}return c.abrupt("return",{props:{error:"Rate limit exceeded"}});case 19:return c.next=21,y.json();case 21:if(w=(C=c.sent)["is-widget-enabled"],S=null!==(t=C["allowed-origin-domains"])&&void 0!==t?t:["self"],e.res.setHeader("Content-Security-Policy","frame-ancestors ".concat(S.join(" "))),r)try{_=function toKebabCase(e){return(0,I.isObject)(e)?Object.keys(e).reduce(function(t,n){return t[(0,I.camelCase)(n).replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase()]=toKebabCase(e[n]),t},{}):e}(JSON.parse(r)),C=(0,I.merge)({},C,_)}catch(e){console.error("Error parsing query config data:",e)}if(!(!w||!C["is-widget-enabled"])){c.next=28;break}return c.abrupt("return",{props:{error:"Widget is disabled"}});case 28:return c.abrupt("return",{props:{communityId:null!=o?o:null,configData:C,encodedConversationTicketSourceUrl:null!=i?i:null,ticketConversationId:null!=d?d:null}});case 31:return c.prev=31,c.t0=c.catch(0),console.log("web support widget loading error: "+c.t0),c.abrupt("return",{props:{error:"API error"}});case 35:case"end":return c.stop()}},_callee,null,[[0,31]])})),function(e){return a.apply(this,arguments)});t.getServerSideProps=z,(o=r||(r={})).THANKS="thanks",o.CONTACT_SUPPORT="contact-support";var K="conversationId",storeConversationIdInSessionStorage=function(e){sessionStorage.setItem(K,e)}}}]);